---
import Skill from "./Skill.astro";
import { skillCategories } from "../data/skills";
---

<div class="mt-16">
  <h2 class="text-2xl sm:text-3xl font-medium text-gray-100/80">Skills</h2>
  <p class="mt-7 text-xl text-gray-100/50">
    I have been involved in this endeavor for nearly <span id="experience"></span> years, 
    and it has been a journey filled with valuable lessons and personal growth.
  </p>
  
  <!-- Category Filter Tags -->
  <div class="mt-9 grid grid-cols-2 sm:flex sm:flex-wrap gap-3" id="category-filters">
    <button 
      data-category="all" 
      class="category-tag active px-4 py-2 rounded-lg bg-linear-to-r from-blue-400 to-lightBlue-500 text-white font-medium hover:from-blue-500 hover:to-lightBlue-600 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 text-center"
    >
      All
    </button>
    {
      skillCategories.map((category) => (
        <button 
          data-category={category.category} 
          class="category-tag px-4 py-2 rounded-lg bg-white/5 text-gray-300 font-medium hover:bg-white/10 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 text-center"
        >
          {category.category}
        </button>
      ))
    }
  </div>

  <!-- Skills Grid -->
  <div class="mt-9 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2" id="skills-grid">
    {
      skillCategories.map((category) => (
        category.skills.map((skill) => (
          <div data-category={category.category}>
            <Skill title={skill.title} icon={skill.icon} link={skill.link} />
          </div>
        ))
      ))
    }
  </div>
</div>

<script>
  import { getYearDiffFromDate } from "../utils/getYearDiffFromDate";

  const experience = document.getElementById("experience");
  experience!.innerText = getYearDiffFromDate("06/20/2019").toString();

  // Category filtering
  const categoryTags = document.querySelectorAll('.category-tag');
  const skillItems = document.querySelectorAll('#skills-grid > div');

  categoryTags.forEach(tag => {
    tag.addEventListener('click', () => {
      const selectedCategory = tag.getAttribute('data-category');
      
      // Update active state
      categoryTags.forEach(t => {
        t.classList.remove('active', 'from-blue-400', 'to-lightBlue-500', 'bg-gradient-to-r', 'text-white');
        t.classList.add('bg-white/5', 'text-gray-300');
      });
      tag.classList.add('active', 'bg-gradient-to-r', 'from-blue-400', 'to-lightBlue-500', 'text-white');
      tag.classList.remove('bg-white/5', 'text-gray-300');

      // Filter skills
      skillItems.forEach(item => {
        const htmlItem = item as HTMLElement;
        if (selectedCategory === 'all' || item.getAttribute('data-category') === selectedCategory) {
          htmlItem.style.display = 'block';
        } else {
          htmlItem.style.display = 'none';
        }
      });
    });
  });
</script>